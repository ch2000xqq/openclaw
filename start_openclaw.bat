@echo off
REM =============================================
REM OpenClaw 一键更新、构建并启动脚本（中文/无乱码）
REM =============================================

:: 使用 UTF-8 编码，防止中文乱码
chcp 65001 >nul

echo ==================================================
echo 1. 切换到 main 分支并拉取最新代码
echo ==================================================
git checkout main
git pull origin main

echo.
echo ==================================================
echo 2. 检查未提交修改
echo ==================================================
git status
echo.
echo 如果有需要保留的修改，请先手动提交或恢复
pause

echo.
echo ==================================================
echo 3. 安装后端依赖
echo ==================================================
pnpm install

echo.
echo ==================================================
echo 4. 安装并构建前端控制面板 UI
echo ==================================================
cd extensions/control-ui
pnpm install
pnpm run build
cd ../../

echo.
echo ==================================================
echo 5. 安装可选模块 @homebridge/ciao（防止 bonjour 报错）
echo ==================================================
pnpm add -D @homebridge/ciao

echo.
echo ==================================================
echo 6. 启动 OpenClaw gateway
echo ==================================================
npx openclaw gateway --dev

echo.
echo ==================================================
echo OpenClaw 启动完成
echo ==================================================
pause
